<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kts Family Cloud (6 Số)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- 1. CSS GIAO DIỆN --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background-color: #050b14; color: #ffffff; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* Màn hình khóa */
        #lockScreen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #020617; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .pin-dots { display: flex; gap: 10px; margin: 20px 0; }
        .dot { width: 15px; height: 15px; border-radius: 50%; background: #334155; transition: 0.2s; }
        .dot.filled { background: #3b82f6; box-shadow: 0 0 10px #3b82f6; }
        .num-pad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .num-btn { background: #1e293b; color: white; border: 1px solid #334155; padding: 15px; border-radius: 50%; font-size: 1.2rem; cursor: pointer; width: 60px; height: 60px; margin: 5px; transition: 0.2s;}
        .num-btn:active { background: #3b82f6; transform: scale(0.9); }

        /* Giao diện chính */
        .navbar { display: flex; justify-content: space-between; align-items: center; padding: 0 20px; background-color: #0a0e17; border-bottom: 1px solid #1f2937; height: 60px; }
        .logo { font-size: 1.3rem; font-weight: 800; color: #3b82f6; text-transform: uppercase; display: flex; align-items: center; gap: 10px; }
        .btn-tool { background: #1e293b; color: #cbd5e1; border: 1px solid #334155; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; }
        .btn-tool:hover { background: #334155; color: white; }
        
        .main-wrapper { display: flex; flex: 1; overflow: hidden; }
        .sidebar { width: 250px; background-color: #0f1623; border-right: 1px solid #1f2937; padding: 20px; overflow-y: auto; }
        .folder-item { display: flex; justify-content: space-between; padding: 10px; color: #cbd5e1; cursor: pointer; border-radius: 6px; margin-bottom: 5px; }
        .folder-item.active { background-color: #1d4ed8; color: white; }
        
        .content-area { flex: 1; padding: 20px; overflow-y: auto; background-color: #050b14; }
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 20px; }
        
        .card { background-color: #111827; border: 1px solid #1f2937; border-radius: 12px; padding: 15px; position: relative; display: flex; flex-direction: column; }
        .card:hover { border-color: #3b82f6; }
        .card-header { display: flex; gap: 12px; align-items: center; margin-bottom: 12px; }
        .card-icon { width: 40px; height: 40px; border-radius: 8px; background: white; object-fit: contain; padding: 2px; }
        
        /* Modal */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(5px); }
        .modal-content { background: #1e293b; margin: 5% auto; padding: 25px; width: 500px; border-radius: 12px; border: 1px solid #3b82f6; max-height: 80vh; overflow-y: auto; }
        .cloud-status { font-size: 0.8rem; color: #10b981; margin-right: 15px; display: none; }
        input, select { width: 100%; padding: 10px; margin-bottom: 10px; background: #0f1623; border: 1px solid #334155; color: white; border-radius: 6px; }
        button { cursor: pointer; }
    </style>
</head>
<body>

    <div id="lockScreen">
        <h2 style="color: #3b82f6; margin-bottom: 20px;"><i class="fas fa-lock"></i> Kts Family (6 Số)</h2>
        
        <div class="pin-dots">
            <div class="dot" id="dot1"></div>
            <div class="dot" id="dot2"></div>
            <div class="dot" id="dot3"></div>
            <div class="dot" id="dot4"></div>
            <div class="dot" id="dot5"></div>
            <div class="dot" id="dot6"></div>
        </div>

        <div class="num-pad">
            <button class="num-btn" onclick="p(1)">1</button><button class="num-btn" onclick="p(2)">2</button><button class="num-btn" onclick="p(3)">3</button>
            <button class="num-btn" onclick="p(4)">4</button><button class="num-btn" onclick="p(5)">5</button><button class="num-btn" onclick="p(6)">6</button>
            <button class="num-btn" onclick="p(7)">7</button><button class="num-btn" onclick="p(8)">8</button><button class="num-btn" onclick="p(9)">9</button>
            <div></div><button class="num-btn" onclick="p(0)">0</button><button class="num-btn" onclick="clr()" style="color:#ef4444"><i class="fas fa-times"></i></button>
        </div>
        <p id="msg" style="color:#ef4444; height:20px; margin-top:10px;"></p>
    </div>

    <div id="mainApp" style="display: none; height: 100%;">
        <nav class="navbar">
            <div class="logo"><i class="fas fa-cloud"></i> Kts Cloud</div>
            <div style="display: flex; align-items: center;">
                <span id="cloudMsg" class="cloud-status"><i class="fas fa-check-circle"></i> Đã kết nối</span>
                <button class="btn-tool" onclick="openSettingModal()" style="margin-right: 10px; border-color: #3b82f6; color: #3b82f6;">
                    <i class="fas fa-sync"></i> Đồng Bộ
                </button>
                <button onclick="openAddModal()" class="btn-tool" style="background:#2563eb; color:white; border:none; font-weight:bold;">+ Thêm</button>
            </div>
        </nav>

        <div class="main-wrapper">
            <div class="sidebar">
                <div class="folder-item active" onclick="selFold('all',this)"><span><i class="fas fa-th-large"></i> Tất cả</span></div>
                <div id="folderList"></div>
                <button onclick="addFold()" style="background:none; border:1px dashed #475569; color:#94a3b8; width:100%; padding:5px; margin-top:10px;">+ Folder</button>
            </div>
            <div class="content-area">
                <h2 id="pageTitle" style="margin-bottom:20px;">Tất cả</h2>
                <div id="grid" class="grid-container"></div>
            </div>
        </div>
    </div>

    <div id="settingModal" class="modal">
        <div class="modal-content">
            <span style="float:right; cursor:pointer; font-size:24px;" onclick="closeM('settingModal')">&times;</span>
            <h2 style="color:#3b82f6; margin-bottom:10px;">Cấu hình Đồng bộ</h2>
            
            <div style="background:#0f1623; padding:15px; border-radius:8px; border:1px solid #334155; margin-bottom:20px;">
                <label style="color:#facc15; font-size:0.9rem;">Nhập thông tin từ JSONBin:</label>
                <input type="text" id="cfgBinID" placeholder="Bin ID (Lấy từ Metadata)">
                <input type="password" id="cfgApiKey" placeholder="API Key (Lấy từ phần API Keys)">
                <button onclick="saveConfig()" style="width:100%; padding:8px; background:#1f2937; color:white; border:1px solid #475569;">Lưu Cấu Hình</button>
            </div>

            <div style="display:flex; gap:10px;">
                <button onclick="pushToCloud()" style="flex:1; padding:15px; background:#059669; border:none; border-radius:8px; color:white; font-weight:bold;">
                    <i class="fas fa-cloud-upload-alt"></i> Gửi lên Mây
                </button>
                <button onclick="pullFromCloud()" style="flex:1; padding:15px; background:#2563eb; border:none; border-radius:8px; color:white; font-weight:bold;">
                    <i class="fas fa-cloud-download-alt"></i> Lấy về Máy
                </button>
            </div>
            <p id="syncStatus" style="text-align:center; margin-top:10px; color:#10b981;"></p>
        </div>
    </div>

    <div id="addModal" class="modal"><div class="modal-content">
        <h2 style="margin-bottom:10px;">Thêm Mới</h2>
        <input id="inpName" placeholder="Tên Web"><select id="inpCat"></select><input id="inpDesc" placeholder="Mô tả"><input id="inpLink" placeholder="Link">
        <button onclick="saveTool()" style="width:100%; padding:10px; background:#2563eb; color:white; border:none;">Lưu</button>
        <button onclick="closeM('addModal')" style="width:100%; padding:10px; background:none; border:none; color:#94a3b8;">Hủy</button>
    </div></div>

    <div id="accModal" class="modal"><div class="modal-content">
        <span style="float:right; cursor:pointer;" onclick="closeM('accModal')">&times;</span>
        <h2 id="accTitle" style="color:#3b82f6;">Tài khoản</h2>
        <div style="margin-bottom:15px; padding:10px; background:#0f1623; border-radius:6px;">
            <input id="newU" placeholder="User"><input id="newP" placeholder="Pass"><input id="newN" placeholder="Ghi chú">
            <button onclick="addAcc()" style="width:100%; background:#059669; color:white; padding:8px; border:none;">+ Thêm</button>
        </div>
        <div id="accList"></div>
    </div></div>

    <script>
        // --- 1. CẤU HÌNH MÃ PIN (QUAN TRỌNG: SỬA Ở DÒNG DƯỚI) ---
        const PIN = "412759"; // <-- BẠN SỬA SỐ 123456 THÀNH SỐ CỦA BẠN (6 SỐ)
        let curPin = "";
        
        // Data & Config
        let folders = JSON.parse(localStorage.getItem('f')) || [{id:'w',name:'Công việc'}];
        let tools = JSON.parse(localStorage.getItem('t')) || [];
        let curFilter='all', curToolIdx=-1;
        let binId = localStorage.getItem('binId') || "";
        let apiKey = localStorage.getItem('apiKey') || "";

        // --- 2. XỬ LÝ MÃ PIN 6 SỐ ---
        function p(n){ 
            if(curPin.length < 6){ // Cho phép nhập 6 số
                curPin += n; 
                dr(); 
                if(curPin.length == 6) chk(); // Đủ 6 số mới kiểm tra
            }
        }
        function clr(){ curPin=""; dr(); document.getElementById('msg').innerText=""; }
        function dr(){ 
            for(let i=1;i<=6;i++) { // Vẽ 6 dấu chấm
                let d = document.getElementById('dot'+i);
                if(d) d.className = i<=curPin.length ? "dot filled" : "dot";
            }
        }
        function chk(){
            if(curPin===PIN){
                document.getElementById('lockScreen').style.display='none';
                document.getElementById('mainApp').style.display='flex';
                loadCfg(); render();
            } else { document.getElementById('msg').innerText="Sai mã PIN!"; setTimeout(clr,500); }
        }

        // --- 3. CLOUD SYNC ---
        function loadCfg(){
            document.getElementById('cfgBinID').value = binId;
            document.getElementById('cfgApiKey').value = apiKey;
            if(binId && apiKey) document.getElementById('cloudMsg').style.display='inline';
        }

        function saveConfig(){
            binId = document.getElementById('cfgBinID').value.trim();
            apiKey = document.getElementById('cfgApiKey').value.trim();
            localStorage.setItem('binId', binId);
            localStorage.setItem('apiKey', apiKey);
            alert("Đã lưu cấu hình! Giờ bạn có thể Đồng bộ.");
            loadCfg();
        }

        async function pushToCloud(){
            if(!binId || !apiKey) { alert("Chưa nhập cấu hình!"); return; }
            document.getElementById('syncStatus').innerText = "Đang gửi dữ liệu...";
            const data = { folders: folders, tools: tools, date: new Date().toLocaleString() };
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${binId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json', 'X-Master-Key': apiKey },
                    body: JSON.stringify(data)
                });
                if(res.ok) {
                    document.getElementById('syncStatus').innerText = "Thành công! Dữ liệu đã lên mây.";
                    alert("Đã gửi thành công!");
                } else throw new Error("Lỗi mạng");
            } catch(e) { document.getElementById('syncStatus').innerText = "Lỗi: " + e.message; }
        }

        async function pullFromCloud(){
            if(!binId || !apiKey) { alert("Chưa nhập cấu hình!"); return; }
            document.getElementById('syncStatus').innerText = "Đang tải dữ liệu...";
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, {
                    headers: { 'X-Master-Key': apiKey }
                });
                const json = await res.json();
                const data = json.record;
                if(data.tools && data.folders) {
                    if(confirm(`Tìm thấy dữ liệu ngày ${data.date}. Cập nhật ngay?`)) {
                        tools = data.tools; folders = data.folders;
                        saveLocal(); render();
                        document.getElementById('syncStatus').innerText = "Đã cập nhật xong!";
                        closeM('settingModal');
                    }
                }
            } catch(e) { document.getElementById('syncStatus').innerText = "Lỗi tải về: " + e.message; }
        }

        // --- 4. APP LOGIC ---
        function saveLocal(){ localStorage.setItem('f',JSON.stringify(folders)); localStorage.setItem('t',JSON.stringify(tools)); }
        function render(){
            const fl = document.getElementById('folderList'); fl.innerHTML='';
            folders.forEach((f,i)=> fl.innerHTML+=`<div class="folder-item ${curFilter==f.id?'active':''}" onclick="selFold('${f.id}')"><span><i class="fas fa-folder"></i> ${f.name}</span><i class="fas fa-trash" onclick="delFold(${i},event)" style="color:#ef4444;font-size:0.8rem;"></i></div>`);
            const gr = document.getElementById('grid'); gr.innerHTML='';
            const list = tools.filter(t=> curFilter=='all' || t.cat==curFilter);
            list.forEach(t=>{
                const idx = tools.indexOf(t);
                const accCount = t.acc ? t.acc.length : 0;
                gr.innerHTML+=`
                <div class="card">
                    <i class="fas fa-times" onclick="delTool(${idx})" style="position:absolute;top:10px;right:10px;cursor:pointer;color:#64748b;"></i>
                    <div class="card-header"><img src="https://cdn-icons-png.flaticon.com/512/2111/2111432.png" class="card-icon"><div><h3 style="color:white;font-size:1rem;">${t.name}</h3><span style="font-size:0.7rem;background:#1e3a8a;padding:2px 6px;border-radius:4px;">${accCount} Acc</span></div></div>
                    <div style="margin-top:auto;display:flex;gap:10px;"><button onclick="openAcc(${idx})" style="width:40px;background:#334155;border:none;border-radius:6px;color:#facc15;"><i class="fas fa-key"></i></button><a href="${t.link}" target="_blank" style="flex:1;text-align:center;background:#1f2937;color:white;text-decoration:none;padding:8px;border-radius:6px;border:1px solid #374151;font-size:0.9rem;">Truy cập</a></div>
                </div>`;
            });
            const s = document.getElementById('inpCat'); s.innerHTML='';
            folders.forEach(f=> s.innerHTML+=`<option value="${f.id}">${f.name}</option>`);
        }
        function selFold(id){ curFilter=id; render(); }
        function addFold(){ const n=prompt("Tên Folder:"); if(n){ folders.push({id:'f'+Date.now(),name:n}); saveLocal(); render(); }}
        function delFold(i,e){ e.stopPropagation(); if(confirm("Xóa Folder?")){ folders.splice(i,1); saveLocal(); render(); }}
        function openAddModal(){ document.getElementById('addModal').style.display='block'; }
        function saveTool(){
            const n=document.getElementById('inpName').value, l=document.getElementById('inpLink').value;
            if(n&&l){ tools.unshift({name:n, cat:document.getElementById('inpCat').value, desc:document.getElementById('inpDesc').value, link:l, acc:[]}); saveLocal(); render(); closeM('addModal'); document.getElementById('inpName').value=''; document.getElementById('inpLink').value=''; }
        }
        function delTool(i){ if(confirm("Xóa Web?")){ tools.splice(i,1); saveLocal(); render(); }}
        function openAcc(i){ curToolIdx=i; document.getElementById('accTitle').innerText=tools[i].name; renderAcc(); document.getElementById('accModal').style.display='block'; }
        function renderAcc(){
            const d=document.getElementById('accList'); d.innerHTML='';
            (tools[curToolIdx].acc||[]).forEach((a,ix)=> d.innerHTML+=`<div style="display:flex;justify-content:space-between;background:#0f1623;padding:10px;margin-bottom:5px;border-radius:6px;border:1px solid #334155;"><div><div style="color:#facc15;font-size:0.8rem;">${a.n}</div><b>${a.u}</b><br><span style="font-family:monospace;color:#94a3b8;">${a.p}</span></div><div><button onclick="cpy('${a.u}')"><i class="fas fa-user"></i></button> <button onclick="cpy('${a.p}')"><i class="fas fa-key"></i></button> <button onclick="delAcc(${ix})" style="color:#f87171"><i class="fas fa-trash"></i></button></div></div>`);
        }
        function addAcc(){
            const u=document.getElementById('newU').value, p=document.getElementById('newP').value;
            if(u&&p){ if(!tools[curToolIdx].acc) tools[curToolIdx].acc=[]; tools[curToolIdx].acc.push({u:u,p:p,n:document.getElementById('newN').value}); saveLocal(); renderAcc(); render(); document.getElementById('newU').value=''; document.getElementById('newP').value=''; }
        }
        function delAcc(ix){ if(confirm("Xóa Acc?")){ tools[curToolIdx].acc.splice(ix,1); saveLocal(); renderAcc(); render(); }}
        function openSettingModal(){ document.getElementById('settingModal').style.display='block'; }
        function closeM(id){ document.getElementById(id).style.display='none'; }
        function cpy(t){ navigator.clipboard.writeText(t); alert("Copied!"); }
    </script>
</body>
</html>